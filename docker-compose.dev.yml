# Development Docker Compose Configuration
# This extends the base docker-compose.yml with development-specific settings
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

version: '3.8'

services:
  backend:
    environment:
      APP_ENV: local
      APP_DEBUG: 'true'
      LOG_CHANNEL: stack
    volumes:
      - ./backend:/app
      - ./backend/storage:/app/storage
      - ./backend/bootstrap/cache:/app/bootstrap/cache
      # PHP configuration override
      - ./backend/docker/php.ini:/usr/local/etc/php/conf.d/99-custom.ini
    command: /usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf
    ports:
      - "${BACKEND_PORT:-8000}:8000"

  frontend:
    environment:
      - VITE_API_URL=http://localhost:${BACKEND_PORT:-8000}
      - NODE_ENV=development
    volumes:
      - ./frontend:/app
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - ./frontend/quasar.config.js:/app/quasar.config.js
    # Override to use dev server instead of nginx
    command: npm run dev -- --host 0.0.0.0 --port 80
    ports:
      - "${FRONTEND_PORT:-80}:80"

  # Optional: Database management service (pgAdmin for PostgreSQL, or phpMyAdmin for MySQL)
  # Uncomment if you switch from SQLite to MySQL/PostgreSQL
  # phpmyadmin:
  #   image: phpmyadmin:latest
  #   ports:
  #     - "8080:80"
  #   environment:
  #     PMA_HOST: db
  #     PMA_USER: ${DB_USERNAME}
  #     PMA_PASSWORD: ${DB_PASSWORD}
  #   depends_on:
  #     - backend
